<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta class="Author" content="John Cuesta, Luis Lama, David Neira">
		<title>Tablero de Ajedrez</title>
		<style>
			body{margin:0;}
			canvas{width:100%; height:100%;}
			#BODY_Title{position:absolute; display:block; width:100%; top:10px;
						padding-left:10px; color: white; background-color:#444444;}
		</style>
	</head>
	<body>
		<div id="BODY_Title">Autores: John Cuesta, Luis Lama, David Neira</div>
		<script type="text/javascript" src="3js/three.js"></script>
		<script type="text/javascript" src="3js/OrbitControls.js"></script>
		<script type="text/javascript" src="3js/dat.gui.min.js"></script>
		<script>
			// scene, camera and renderer --> render the scene with camera.
			var scene = new THREE.Scene();
			var backgroundScene = "#002233"
			scene.background = new THREE.Color(backgroundScene);
			var camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,500);
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth,window.innerHeight);
			document.body.appendChild(renderer.domElement);
			
			// to orbit with mouse
			var mouseOrbit = new THREE.OrbitControls(camera, renderer.domElement);
			
			// tablero
			var getMaterial = function(colorDesired){
				let material = new THREE.MeshPhongMaterial({ color:colorDesired, side: THREE.DoubleSide, flatShading: true });
				return material;}
			var tablero = new THREE.Group();
			var tile_width=2;
			var tile_color="#ffffff";
			var addTablero = function(){
				var tile_geometry = new THREE.BoxGeometry(tile_width,tile_width/10,tile_width);
				var black_material = getMaterial("#000000");   //fixed color
				var color_material = getMaterial(tile_color);  //to change with gui
				var black_color = -1;
				//Chess Table has 64 tiles, 8 rows, 8 columns
				for(var i = 0; i < 8; i++){
					if (i % 2 == 0) { black_color = -1 }
					else { black_color = 1 };
					for(var j = 0; j < 8; j++){
						var material;
						if(black_color == 1){ material = black_material; }   // iterate black and white
						else{ material = color_material; }
						var tile = new THREE.Mesh( tile_geometry, material );
						tile.position.x = (-4 + j) * tile_width;
                    	tile.position.z = (-4 + i) * tile_width;
                    	tablero.add(tile);
                    	black_color *= -1; } }
				scene.add(tablero); }

			var ambient_light, white_light;               // white
			var red_light, green_light, blue_light;       // RGB
			var cyan_light, magenta_light, yellow_light;  // CMY

			var getSpotLight = function(colorDesired,intensity){
				spotLight = new THREE.SpotLight( colorDesired, intensity );
        		return spotLight; }
			var addLights = function( distanceFromCenter ){
        		white_up_light = getSpotLight("#ffffff",1);
        		white_up_light.position.set(0 - tile_width, 20, 0 - tile_width);
        		scene.add(white_up_light);

        		white_down_light = getSpotLight("#ffffff",1);
        		white_down_light.position.set(0 - tile_width, -20, 0 - tile_width);
        		scene.add(white_down_light);

        		red_light = getSpotLight("#ff0000",6);
        		red_light.position.set(distanceFromCenter - tile_width, 20, distanceFromCenter - tile_width);
        		scene.add(red_light);

        		green_light = getSpotLight("#00ff00",6);
        		green_light.position.set( -distanceFromCenter - tile_width, 20, distanceFromCenter - tile_width);
        		scene.add(green_light);

        		blue_light = getSpotLight("#0000ff",6);
        		blue_light.position.set( 0 - tile_width, 20, -distanceFromCenter - tile_width);
        		scene.add(blue_light); }

			// GUI
			var params = { up_light: true, down_light: true, background: backgroundScene, red_light: false, green_light: false , blue_light: false, non_black_tiles: tile_color, };
        	var nlines = params.length;
			var gui = new dat.GUI({ height: nlines * 32 - 1, });
			gui.add(params, 'up_light');
			gui.add(params, 'down_light');
			gui.addColor(params, 'background').onChange(update);
        	gui.add(params, 'red_light');
        	gui.add(params, 'green_light');
        	gui.add(params, 'blue_light');
        	gui.addColor(params, 'non_black_tiles').onChange(update);

			// load objects
			addTablero();
			distanceFromCenter = 1.75*tile_width;
			addLights( distanceFromCenter );
			camera.position.set(0, 4, 16);

			// update and render loop
			var isHex = function (posible_hex) {
	            let re = /[0-9A-Fa-f]{6}/g;
    	        if (re.test(posible_hex)) { return true; } 
    	        else { return false; } }
			var update = function(){ 
				// change in GUI for lights
            	if (params.up_light) { white_up_light.intensity = 1; }        // white down
	            else { white_up_light.intensity = 0; };
	            if (params.down_light) { white_down_light.intensity = 1; }    // white up
	            else { white_down_light.intensity = 0; };	            
	            if (params.red_light) { red_light.intensity = 6; }            		// red
	            else { red_light.intensity = 0; };
	            if (params.green_light) { green_light.intensity = 6; }        		// green
	            else { green_light.intensity = 0; };
	            if (params.blue_light) { blue_light.intensity = 6; }          		// blue
	            else { blue_light.intensity = 0; };

	            // change in GUI for color_tiles or background
            	let background_hex = new THREE.Color(params.background).getHexString();
    			if ( isHex(background_hex) && scene.background != "#" + background_hex ){
	                    scene.background = new THREE.Color("#"+background_hex); }
            	let color_hex = new THREE.Color(params.non_black_tiles).getHexString();
	            if ( isHex(color_hex) && tile_color != "#" + color_hex ){
	                    tile_color = "#" + color_hex;
	                    let table = scene.getObjectByName(tablero);
	                    scene.remove(table);
	                    addTablero(); } }
			var render = function(){ renderer.render(scene,camera); }
			var showAnimationLoop = function(){
				requestAnimationFrame(showAnimationLoop);
				update();
				render(); }
			showAnimationLoop();
		</script>
	</body>
</html>